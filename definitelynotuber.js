let map,userMarker,vehicleMarkers=[];const mapsScript=document.createElement("script");mapsScript.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDaPv5Vu4W_0lVG6MGRdJ3qukLRAPG3NNA&libraries=geometry,places",mapsScript.defer=!0,mapsScript.onload=()=>{initMap()},document.body.appendChild(mapsScript);const polyfillScript=document.createElement("script");async function getVehicles(){const e=await new Promise(((e,t)=>{navigator.geolocation.getCurrentPosition(e,t)})),{latitude:t,longitude:o}=e.coords,a=`username=yCA9BxBx&lat=${t}&lng=${o}`,n=new XMLHttpRequest;n.open("POST","https://vast-fjord-18474.herokuapp.com/rides"),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.onload=function(){if(200===n.status){createMarkers(JSON.parse(n.responseText))}},n.send(a)}function createMarkers(e){for(const t of e){vehicleMarkers.push(t);new google.maps.Marker({position:{lat:t.lat,lng:t.lng},map:map,icon:"car.png"})}}function showClosestVehicle(){const e=userMarker.getPosition();let t=null,o=1/0;for(const a of vehicleMarkers){const n=new google.maps.LatLng(a.lat,a.lng),l=google.maps.geometry.spherical.computeDistanceBetween(e,n);l<o&&(o=l,t=a)}if(t){const a=`Closest vehicle is ${(o/1609.344).toFixed(2)} miles away.`;new google.maps.InfoWindow({content:a}).open(map,userMarker);const n=new google.maps.LatLng(t.lat,t.lng);new google.maps.Polyline({path:[e,n],strokeColor:"#8A2BE2",strokeOpacity:1,strokeWeight:2,map:map})}}async function initMap(){const{Map:e}=await google.maps.importLibrary("maps","geometry","places");map=new e(document.getElementById("map"),{center:{lat:42.352271,lng:-71.055242},zoom:14}),navigator.geolocation&&navigator.geolocation.getCurrentPosition((e=>{const{latitude:t,longitude:o}=e.coords,a=new google.maps.LatLng(t,o);userMarker=new google.maps.Marker({position:a,map:map,icon:null}),map.setCenter(a),getVehicles(),userMarker.addListener("click",showClosestVehicle)}));const t=[{id:"mXfkjrFw",lat:42.3453,lng:-71.0464},{id:"nZXB8ZHz",lat:42.3662,lng:-71.0621},{id:"Tkwu74WC",lat:42.3603,lng:-71.0547},{id:"5KWpnAJN",lat:42.3472,lng:-71.0802},{id:"uf5ZrXYw",lat:42.3663,lng:-71.0544},{id:"VMerzMH8",lat:42.3542,lng:-71.0704}];for(const e of t){new google.maps.Marker({position:{lat:e.lat,lng:e.lng},map:map,icon:"car.png"})}}polyfillScript.src="https://polyfill.io/v3/polyfill.min.js?features=default",document.body.appendChild(polyfillScript);